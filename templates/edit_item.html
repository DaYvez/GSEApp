{% extends "base.html" %}

{% block title %}Edit Item - Green Super Electronics{% endblock %}

{% block styles %}
<style>
    .form-control, .input-group-text {
        background-color: #2c3034;
        border-color: #495057;
        color: #ffffff;
    }
    .form-control:focus {
        background-color: #2c3034;
        border-color: #0dcaf0;
        color: #ffffff;
    }
    .form-control::placeholder {
        color: #adb5bd;
    }
    .form-label {
        color: #ffffff;
    }
    .card {
        background-color: #1a1d20;
        border-color: #495057;
    }
    .card-header {
        background-color: #212529;
        border-color: #495057;
        color: #ffffff;
    }
    .nav-tabs .nav-link {
        color: #adb5bd;
    }
    .nav-tabs .nav-link.active {
        background-color: #2c3034;
        border-color: #495057;
        color: #ffffff;
    }
    .nav-tabs {
        border-color: #495057;
    }
    .btn-outline-primary {
        color: #0dcaf0;
        border-color: #0dcaf0;
    }
    .btn-outline-primary:hover {
        color: #fff;
        background-color: #0dcaf0;
        border-color: #0dcaf0;
    }
    .text-primary {
        color: #0dcaf0 !important;
    }
    .alert {
        background-color: #1a1d20;
        border-color: #495057;
        color: #ffffff;
    }
    .alert-success {
        background-color: #1a1d20;
        border-color: #198754;
        color: #198754;
    }
    .alert-danger {
        background-color: #1a1d20;
        border-color: #dc3545;
        color: #dc3545;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="text-primary fw-bold mb-0">Edit Item</h4>
        <a href="{{ url_for('index') }}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-arrow-left me-1"></i>Back to Inventory
        </a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category if category != 'error' else 'danger' }} alert-dismissible fade show py-2" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form action="{{ url_for('edit_item', item_id=item.id) }}" method="POST" enctype="multipart/form-data">
        <div class="card shadow-sm">
            <div class="card-header py-2">
                <ul class="nav nav-tabs card-header-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#basic">Basic Info</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#specs">Specifications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#purchase">Purchase Details</a>
                    </li>
                    {% if item.selling_price %}
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#sale">Sale Details</a>
                    </li>
                    {% endif %}
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#images">Images</a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- Basic Info Tab -->
                    <div class="tab-pane fade show active" id="basic">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Item Name</label>
                                <input type="text" class="form-control" name="name" value="{{ item.name }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Item Type</label>
                                <select class="form-select" name="item_type" required>
                                    <option value="laptop" {% if item.item_type == 'laptop' %}selected{% endif %}>Laptop</option>
                                    <option value="smartphone" {% if item.item_type == 'smartphone' %}selected{% endif %}>Smartphone</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Purchase Details Tab -->
                    <div class="tab-pane fade" id="purchase">
                        <div class="row g-3">
                            <div class="col-12">
                                <h6 class="fw-bold text-primary mb-3">Seller Details</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Seller Name</label>
                                        <input type="text" class="form-control" name="seller_name" value="{{ item.seller_name }}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Seller NIC</label>
                                        <input type="text" class="form-control" name="seller_nic" value="{{ item.seller_nic }}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Seller Contact</label>
                                        <input type="text" class="form-control" name="seller_contact" value="{{ item.seller_contact }}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Seller Location</label>
                                        <input type="text" class="form-control" name="seller_location" value="{{ item.seller_location }}" required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <h6 class="fw-bold text-primary mb-3">Purchase Information</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Purchase Date</label>
                                        <input type="date" class="form-control" name="purchase_date" value="{{ item.purchase_date.strftime('%Y-%m-%d') }}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Item Price</label>
                                        <div class="input-group">
                                            <span class="input-group-text">Rs.</span>
                                            <input type="number" class="form-control" name="item_price" value="{{ item.item_price }}" step="0.01" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Transport Cost</label>
                                        <div class="input-group">
                                            <span class="input-group-text">Rs.</span>
                                            <input type="number" class="form-control" name="transport_cost" value="{{ item.transport_cost }}" step="0.01">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Food Cost</label>
                                        <div class="input-group">
                                            <span class="input-group-text">Rs.</span>
                                            <input type="number" class="form-control" name="food_cost" value="{{ item.food_cost }}" step="0.01">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Fuel Cost</label>
                                        <div class="input-group">
                                            <span class="input-group-text">Rs.</span>
                                            <input type="number" class="form-control" name="fuel_cost" value="{{ item.fuel_cost }}" step="0.01">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Other Expenses</label>
                                        <div class="input-group">
                                            <span class="input-group-text">Rs.</span>
                                            <input type="number" class="form-control" name="other_expenses" value="{{ item.other_expenses }}" step="0.01">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Specifications Tab -->
                    <div class="tab-pane fade" id="specs">
                        {% if item.item_type == 'laptop' %}
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">CPU</label>
                                <input type="text" class="form-control" name="specs[cpu]" value="{{ specs.cpu }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">CPU Speed (GHz)</label>
                                <input type="text" class="form-control" name="specs[cpu_speed]" value="{{ specs.cpu_speed }}" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">RAM Capacity (GB)</label>
                                <input type="number" class="form-control" name="specs[ram_capacity]" value="{{ specs.ram_capacity }}" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">RAM Type</label>
                                <input type="text" class="form-control" name="specs[ram_type]" value="{{ specs.ram_type }}" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">RAM Speed (MHz)</label>
                                <input type="number" class="form-control" name="specs[ram_speed]" value="{{ specs.ram_speed }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Storage Type</label>
                                <input type="text" class="form-control" name="specs[storage_type]" value="{{ specs.storage_type }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Storage Size</label>
                                <input type="text" class="form-control" name="specs[storage_size]" value="{{ specs.storage_size }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">GPU Type</label>
                                <input type="text" class="form-control" name="specs[gpu_type]" value="{{ specs.gpu_type }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">GPU Memory</label>
                                <input type="text" class="form-control" name="specs[gpu_memory]" value="{{ specs.gpu_memory }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Display Type</label>
                                <input type="text" class="form-control" name="specs[display_type]" value="{{ specs.display_type }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Display Resolution</label>
                                <input type="text" class="form-control" name="specs[display_resolution]" value="{{ specs.display_resolution }}" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Features</label>
                                <input type="text" class="form-control" name="specs[features][]" value="{{ specs.features|join(', ') }}" placeholder="Comma-separated features">
                            </div>
                        </div>
                        {% else %}
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Model</label>
                                <input type="text" class="form-control" name="specs[model]" value="{{ specs.model }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Capacity</label>
                                <input type="text" class="form-control" name="specs[capacity]" value="{{ specs.capacity }}" required>
                            </div>
                        </div>
                        {% endif %}
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Remarks/Damages</label>
                                <textarea class="form-control" name="specs[remarks]" rows="3">{{ specs.remarks }}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Sale Details Tab -->
                    {% if item.selling_price %}
                    <div class="tab-pane fade" id="sale">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Selling Date</label>
                                <input type="date" class="form-control" name="selling_date" value="{{ item.selling_date.strftime('%Y-%m-%d') }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Selling Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs.</span>
                                    <input type="number" class="form-control" name="selling_price" value="{{ item.selling_price }}" step="0.01" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Sale Transport Cost</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs.</span>
                                    <input type="number" class="form-control" name="sale_transport_cost" value="{{ item.transport_cost }}" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Sale Food Cost</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs.</span>
                                    <input type="number" class="form-control" name="sale_food_cost" value="{{ item.food_cost }}" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Sale Fuel Cost</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs.</span>
                                    <input type="number" class="form-control" name="sale_fuel_cost" value="{{ item.fuel_cost }}" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Sale Other Expenses</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs.</span>
                                    <input type="number" class="form-control" name="sale_other_expenses" value="{{ item.other_expenses }}" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Buyer Name</label>
                                <input type="text" class="form-control" name="buyer_name" value="{{ item.buyer_name }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Buyer NIC</label>
                                <input type="text" class="form-control" name="buyer_nic" value="{{ item.buyer_nic }}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Buyer Contact</label>
                                <input type="text" class="form-control" name="buyer_contact" value="{{ item.buyer_contact }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Buyer Location</label>
                                <input type="text" class="form-control" name="buyer_location" value="{{ item.buyer_location }}" required>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Images Tab -->
                    <div class="tab-pane fade" id="images">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Current Images</label>
                                <div class="row g-2">
                                    {% set images = item.images|from_json %}
                                    {% for image in images %}
                                    <div class="col-md-3">
                                        <a href="{{ image|replace('/view?usp=drivesdk', '') }}" target="_blank" class="text-decoration-none">
                                            <img src="{{ image|replace('/view?usp=drivesdk', '') }}" class="img-fluid rounded" alt="Item Image">
                                        </a>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Upload New Images</label>
                                <input type="file" class="form-control" name="item_images" multiple accept="image/*">
                                <small class="text-muted">Leave empty to keep current images</small>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Current Agreement</label>
                                {% if item.agreement_image %}
                                <div>
                                    <a href="{{ item.agreement_image|replace('/view?usp=drivesdk', '') }}" target="_blank" class="text-decoration-none">
                                        <i class="fas fa-file-signature me-1"></i>View Agreement
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-12">
                                <label class="form-label">Upload New Agreement</label>
                                <input type="file" class="form-control" name="agreement_image" accept="image/*">
                                <small class="text-muted">Leave empty to keep current agreement</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-dark py-2">
                <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });

    // Handle item type change
    const itemTypeSelect = document.querySelector('select[name="item_type"]');
    const specsTab = document.querySelector('#specs');
    
    itemTypeSelect.addEventListener('change', function() {
        // Reload the page to show correct specs form
        window.location.reload();
    });
});
</script>
{% endblock %} 